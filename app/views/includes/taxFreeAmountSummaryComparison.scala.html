@*
 * Copyright 2019 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.urls.Link
@import uk.gov.hmrc.tai.viewModels.taxCodeChange.YourTaxFreeAmountViewModel

@import uk.gov.hmrc.tai.util.yourTaxFreeAmount.CodingComponentPair
@import uk.gov.hmrc.tai.util.yourTaxFreeAmount.CodingComponentPairDescription
@(currentTaxFreeAmount: YourTaxFreeAmountViewModel, gaEventActionString: String, taxCodeChange: Boolean = false)(implicit m: Messages)

@previousTaxFreeInfo = @{ currentTaxFreeAmount.previousTaxFreeInfo }
@currentTaxFreeInfo = @{ currentTaxFreeAmount.currentTaxFreeInfo }
@allowances = @{ currentTaxFreeAmount.allowances }
@deductions = @{ currentTaxFreeAmount.deductions }

<table class="tax-free-amount-comparison-table responsive-table">
    <caption class="visuallyhidden">ADD A CAPTION</caption>
    <thead>
        <tr role="row">
            <th scope="col"></th>
            <th scope="col" class="numeric">Previous tax code</th>
            <th scope="col" class="numeric">Current tax code</th>
        </tr>
    </thead>
    <tbody>
        @personalAllowanceRow
        @iabdBreakdownRows(allowances, "Additions", "Total Additions")
        @iabdBreakdownRows(deductions, "Deductions", "Total Deductions")
        @totalTaxFreeAmountRow
    </tbody>
</table>


@personalAllowanceRow = {
    <tr role="row">
        <td class="tax-free-amount-comparison-row-title">Personal Allowance</td>
        <td class="numeric">
            <span aria-hidden="true" class="table-heading">Previous</span>
            @YourTaxFreeAmountViewModel.prettyPrint(previousTaxFreeInfo.personalAllowance)
        </td>
        <td class="numeric">
            <span aria-hidden="true" class="table-heading">Current</span>
            @YourTaxFreeAmountViewModel.prettyPrint(currentTaxFreeInfo.personalAllowance)
        </td>
    </tr>
}

@iabdBreakdownRows(sequence: Seq[CodingComponentPairDescription], title: String, totalTitle: String) = {

    <tr role="row">
        <td colspan="3"><h3 class="tax-free-amount-comparison-row-heading">@title</h3></td>
    </tr>

    @if(sequence.isEmpty) {
        <tr role="row">
            <td class="tax-free-amount-comparison-row-title">You do not have any @title</td>
            <td class="numeric"><span aria-hidden="true" class="table-heading">Previous</span>£0</td>
            <td class="numeric"><span aria-hidden="true" class="table-heading">Current</span>£0</td>
        </tr>
    } else {
        @for(pair <- sequence) {
            <tr role="row">
                <td class="tax-free-amount-comparison-row-title">@pair.description</td>
                <td class="numeric">
                    <span aria-hidden="true" class="table-heading">Previous</span>
                    <span aria-hidden="true">@YourTaxFreeAmountViewModel.prettyPrint(pair.previous)</span>
                    <span class="visuallyhidden">@pair.description @YourTaxFreeAmountViewModel.prettyPrint(pair.previous)</span>
                </td>
                <td class="numeric">
                    <span aria-hidden="true" class="table-heading">Current</span>
                    <span aria-hidden="true">@YourTaxFreeAmountViewModel.prettyPrint(pair.current)</span>
                    <span class="visuallyhidden">@pair.description @YourTaxFreeAmountViewModel.prettyPrint(pair.current)</span>
                </td>
            </tr>
        }

        <tr role="row">
            <td class="tax-free-amount-comparison-row-title">@totalTitle</td>
            <td class="numeric">
                <span aria-hidden="true" class="table-heading carr">Previous</span>
                <span aria-hidden="true">@YourTaxFreeAmountViewModel.totalPrevious(sequence)</span>
                <span class="visuallyhidden">@totalTitle @YourTaxFreeAmountViewModel.totalPrevious(sequence)</span>
            </td>
            <td class="numeric">
                <span aria-hidden="true" class="table-heading">Current</span>
                <span aria-hidden="true">@YourTaxFreeAmountViewModel.totalCurrent(sequence)</span>
                <span class="visuallyhidden">@totalTitle @YourTaxFreeAmountViewModel.totalCurrent(sequence)</span>
            </td>
        </tr>
    }
}

@totalTaxFreeAmountRow = {
    <tr  class="highlight" role="row">
        <td><h3>Your total tax-free amount</h3></td>
        <td class="numeric">
            <span aria-hidden="true" class="table-heading">Previous</span>
            <span aria-hidden="true">@YourTaxFreeAmountViewModel.prettyPrint(previousTaxFreeInfo.annualTaxFreeAmount)</span>
            <span class="visuallyhidden">Your total tax-free amount @YourTaxFreeAmountViewModel.prettyPrint(previousTaxFreeInfo.annualTaxFreeAmount)</span>
        </td>
        <td class="numeric">
            <span aria-hidden="true" class="table-heading">Current</span>
            <span aria-hidden="true">@YourTaxFreeAmountViewModel.prettyPrint(currentTaxFreeInfo.annualTaxFreeAmount)</span>
            <span class="visuallyhidden">Your total tax-free amount @YourTaxFreeAmountViewModel.prettyPrint(currentTaxFreeInfo.annualTaxFreeAmount)</span>
        </td>
    </tr>
}