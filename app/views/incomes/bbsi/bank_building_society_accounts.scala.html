@*
 * Copyright 2018 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import includes.ptaHeader
@import uk.gov.hmrc.tai.config.TaiHtmlPartialRetriever
@import uk.gov.hmrc.tai.model.domain.{BankAccount,UntaxedInterest}
@import uk.gov.hmrc.urls.Link
@import uk.gov.hmrc.tai.model.tai.TaxYear
@import uk.gov.hmrc.play.views.formatting.Money._

@(untaxedInterest: UntaxedInterest)(implicit request: Request[_], messages: Messages, user: controllers.auth.TaiUser, templateRenderer: uk.gov.hmrc.renderer.TemplateRenderer, partialRetriever: uk.gov.hmrc.play.partials.PartialRetriever = TaiHtmlPartialRetriever)

@header = @{
    ptaHeader(
        displayBackLink = true,
        mainHeadingText = messages("tai.bbsi.accountDetails.heading"),
        preHeadingText = messages("tai.bbsi.account.preHeading")
    )
}

@main(
    title = messages("tai.bbsi.accountDetails.heading"),
    user = Some(user),
    pageHeader = Some(header),
    articleClasses = None,
    gaCustomTitle = None
) {
    <p >@messages("tai.bbsi.account.desc1")</p>
    <p >@messages("tai.bbsi.account.desc2")</p>

<table class="subsection flush--top">
    <caption class="text--left section flush--bottom">@messages("tai.bbsi.account.table.heading", TaxYear().year.toString, TaxYear().next.year.toString)</caption>
    <thead>
    <tr>
        <th>@messages("tai.bbsi.account.table.accountDetails")</th>
        <th class="text--right">@messages("tai.bbsi.account.table.amount")</th>
        <th class="text--right">@messages("tai.bbsi.account.table.action")</th>
    </tr>
    </thead>
    <tbody>
    @for(bankAccount <- untaxedInterest.bankAccounts.sortBy(- _.grossInterest)) {
    <tr>
        @if(bankAccount.accountNumber.forall(_.endsWith("0000")) && bankAccount.sortCode.forall(_.equals("000000"))){
        <td>
            <span class="display-block break-word"><b class="bold">@messages("tai.bbsi.account.accountDetailsUnavailable")</b></span>
            <span class="display-block break-word">@messages("tai.bbsi.account.youToldUsTheAmount")</span>
        </td>
        <td class="text--right">@pounds(bankAccount.grossInterest, 2)</td>
        <td class="text--right"></td>
        }else{
        <td>
            <span class="display-block break-word"><b class="bold">@bankAccount.bankName.getOrElse("")</b></span>
            <span class="display-block break-word">@bankAccount.accountNumber.getOrElse("")</span>
            <span class="display-block break-word">@bankAccount.formattedSortCode.getOrElse("")</span>
        </td>
        <td class="text--right">@pounds(bankAccount.grossInterest, 2)</td>
        <td class="text--right">@Link.toInternalPage(url=controllers.income.bbsi.routes.BbsiController.decision(bankAccount.id).url,id= Some(s"bbsiAccountDecision${bankAccount.id}"), value=Some(messages("tai.bbsi.account.updateOrRemoveLink"))).toHtml</td>
        }

    </tr>
    }
    </tbody>
    <tfoot class = "table__footer--highlight">
    <tr class="highlight">
        <td>@messages("tai.bbsi.account.table.total")</td>
        <td class="text--right">@pounds(untaxedInterest.amount, 2)</td>
        <td></td>
    </tr>
    </tfoot>
</table>

<div class="panel-indent">
    <p>@messages("tai.bbsi.account.totalEstimatedInterest.desc1")</p>
    <p>@messages("tai.bbsi.account.totalEstimatedInterest.desc2", untaxedInterest.amount, TaxYear().year.toString, TaxYear().next.year.toString)</p>
</div>

<div>
    <h3>@messages("tai.bbsi.account.whatHappensNext.title")</h3>
    <p>@messages("tai.bbsi.account.whatHappensNext.desc1")</p>
    <p>@messages("tai.bbsi.account.whatHappensNext.desc2", TaxYear().year.toString, TaxYear().next.year.toString)</p>
</div>

@Link.toInternalPage(url=controllers.routes.TaxAccountSummaryController.onPageLoad().url,id=Some("returnToSummary"), value=Some(messages("tai.IncomeTaxSummaryReturn"))).toHtml
}